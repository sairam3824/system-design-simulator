{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/sairammaruri/Documents/Git/system-design/system-design-simulator/src/lib/cache.ts"],"sourcesContent":["/**\n * Cache Utilities\n *\n * Provides helpers for caching with Redis.\n * All operations gracefully fall back to direct execution if Redis is unavailable.\n */\n\nimport { getRedisClient, isRedisAvailable, CACHE_TTL } from \"./redis\";\n\n/**\n * Get a cached value by key\n */\nexport async function cacheGet<T>(key: string): Promise<T | null> {\n  if (!isRedisAvailable()) {\n    return null;\n  }\n\n  try {\n    const redis = getRedisClient();\n    if (!redis) return null;\n\n    const value = await redis.get(key);\n    return value as T | null;\n  } catch (error) {\n    console.error(\"Cache get error:\", error);\n    return null;\n  }\n}\n\n/**\n * Set a cached value with TTL\n */\nexport async function cacheSet<T>(\n  key: string,\n  value: T,\n  ttlSeconds: number = CACHE_TTL.USER_ANALYTICS\n): Promise<boolean> {\n  if (!isRedisAvailable()) {\n    return false;\n  }\n\n  try {\n    const redis = getRedisClient();\n    if (!redis) return false;\n\n    await redis.set(key, JSON.stringify(value), { ex: ttlSeconds });\n    return true;\n  } catch (error) {\n    console.error(\"Cache set error:\", error);\n    return false;\n  }\n}\n\n/**\n * Delete a cached value\n */\nexport async function cacheDelete(key: string): Promise<boolean> {\n  if (!isRedisAvailable()) {\n    return false;\n  }\n\n  try {\n    const redis = getRedisClient();\n    if (!redis) return false;\n\n    await redis.del(key);\n    return true;\n  } catch (error) {\n    console.error(\"Cache delete error:\", error);\n    return false;\n  }\n}\n\n/**\n * Delete multiple cached values by pattern\n */\nexport async function cacheDeletePattern(pattern: string): Promise<boolean> {\n  if (!isRedisAvailable()) {\n    return false;\n  }\n\n  try {\n    const redis = getRedisClient();\n    if (!redis) return false;\n\n    // Upstash Redis supports SCAN for pattern matching\n    let cursor = 0;\n    do {\n      const [newCursor, keys] = await redis.scan(cursor, {\n        match: pattern,\n        count: 100,\n      });\n      cursor = parseInt(newCursor as string, 10);\n\n      if (keys.length > 0) {\n        await redis.del(...keys);\n      }\n    } while (cursor !== 0);\n\n    return true;\n  } catch (error) {\n    console.error(\"Cache delete pattern error:\", error);\n    return false;\n  }\n}\n\n/**\n * Get or fetch pattern - returns cached value or fetches and caches it\n */\nexport async function getOrFetch<T>(\n  key: string,\n  fetcher: () => Promise<T>,\n  ttlSeconds: number = CACHE_TTL.USER_ANALYTICS\n): Promise<T> {\n  // Try to get from cache first\n  const cached = await cacheGet<T>(key);\n  if (cached !== null) {\n    // Parse if it's a string (JSON)\n    if (typeof cached === \"string\") {\n      try {\n        return JSON.parse(cached) as T;\n      } catch {\n        return cached as T;\n      }\n    }\n    return cached;\n  }\n\n  // Fetch fresh data\n  const fresh = await fetcher();\n\n  // Cache the result\n  await cacheSet(key, fresh, ttlSeconds);\n\n  return fresh;\n}\n\n/**\n * Invalidate user analytics cache\n */\nexport async function invalidateUserAnalytics(userId: string): Promise<void> {\n  await cacheDeletePattern(`analytics:user:${userId}*`);\n}\n\n/**\n * Invalidate leaderboard cache\n */\nexport async function invalidateLeaderboard(): Promise<void> {\n  await cacheDeletePattern(\"leaderboard:*\");\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;CAKC,GAED;;AAKO,eAAe,SAAY,GAAW;IAC3C,IAAI,CAAC,IAAA,kOAAgB,KAAI;QACvB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,QAAQ,IAAA,gOAAc;QAC5B,IAAI,CAAC,OAAO,OAAO;QAEnB,MAAM,QAAQ,MAAM,MAAM,GAAG,CAAC;QAC9B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO;IACT;AACF;AAKO,eAAe,SACpB,GAAW,EACX,KAAQ,EACR,aAAqB,2NAAS,CAAC,cAAc;IAE7C,IAAI,CAAC,IAAA,kOAAgB,KAAI;QACvB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,QAAQ,IAAA,gOAAc;QAC5B,IAAI,CAAC,OAAO,OAAO;QAEnB,MAAM,MAAM,GAAG,CAAC,KAAK,KAAK,SAAS,CAAC,QAAQ;YAAE,IAAI;QAAW;QAC7D,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO;IACT;AACF;AAKO,eAAe,YAAY,GAAW;IAC3C,IAAI,CAAC,IAAA,kOAAgB,KAAI;QACvB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,QAAQ,IAAA,gOAAc;QAC5B,IAAI,CAAC,OAAO,OAAO;QAEnB,MAAM,MAAM,GAAG,CAAC;QAChB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;IACT;AACF;AAKO,eAAe,mBAAmB,OAAe;IACtD,IAAI,CAAC,IAAA,kOAAgB,KAAI;QACvB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,QAAQ,IAAA,gOAAc;QAC5B,IAAI,CAAC,OAAO,OAAO;QAEnB,mDAAmD;QACnD,IAAI,SAAS;QACb,GAAG;YACD,MAAM,CAAC,WAAW,KAAK,GAAG,MAAM,MAAM,IAAI,CAAC,QAAQ;gBACjD,OAAO;gBACP,OAAO;YACT;YACA,SAAS,SAAS,WAAqB;YAEvC,IAAI,KAAK,MAAM,GAAG,GAAG;gBACnB,MAAM,MAAM,GAAG,IAAI;YACrB;QACF,QAAS,WAAW,EAAG;QAEvB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;AACF;AAKO,eAAe,WACpB,GAAW,EACX,OAAyB,EACzB,aAAqB,2NAAS,CAAC,cAAc;IAE7C,8BAA8B;IAC9B,MAAM,SAAS,MAAM,SAAY;IACjC,IAAI,WAAW,MAAM;QACnB,gCAAgC;QAChC,IAAI,OAAO,WAAW,UAAU;YAC9B,IAAI;gBACF,OAAO,KAAK,KAAK,CAAC;YACpB,EAAE,OAAM;gBACN,OAAO;YACT;QACF;QACA,OAAO;IACT;IAEA,mBAAmB;IACnB,MAAM,QAAQ,MAAM;IAEpB,mBAAmB;IACnB,MAAM,SAAS,KAAK,OAAO;IAE3B,OAAO;AACT;AAKO,eAAe,wBAAwB,MAAc;IAC1D,MAAM,mBAAmB,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;AACtD;AAKO,eAAe;IACpB,MAAM,mBAAmB;AAC3B"}}]
}