module.exports=[12766,e=>{"use strict";let t=["google","meta","facebook","amazon","apple","microsoft","netflix","uber","airbnb","stripe","coinbase","linkedin","twitter","x","openai","anthropic","databricks","snowflake","palantir","nvidia","tesla","spacex","bloomberg","citadel","two sigma","jane street","bytedance","tiktok","spotify","dropbox","slack","salesforce"],a=["system design","distributed systems","microservices","kubernetes","docker","aws","gcp","azure","kafka","redis","elasticsearch","mongodb","postgresql","mysql","cassandra","dynamodb","graphql","rest api","load balancing","caching","sharding","replication","cap theorem","event-driven","message queues","rabbitmq","grpc","websockets","cdn","api gateway","service mesh","istio","terraform","ci/cd","scalability","high availability","fault tolerance","database design"];function i(e){var i;let s,{selectedDifficulty:r,profile:n,resume:o}=e,l=(i=n?.yearsExperience)&&!(i<=0)?i<=2?20+i/2*20:i<=5?40+(i-2)/3*20:i<=10?60+(i-5)/5*20:Math.min(100,80+(i-10)/10*20):20,c=function(e){if(!e||0===e.length)return 30;let t=e.map(e=>e.toLowerCase().trim()),i=0,s=0;for(let e of t)for(let t of a)if(e.includes(t)||t.includes(e)){i++,["distributed systems","cap theorem","sharding","service mesh","event-driven"].some(t=>e.includes(t))?s+=15:["kubernetes","kafka","elasticsearch","microservices"].some(t=>e.includes(t))?s+=12:s+=8;break}return Math.min(100,Math.min(50,10*i)+Math.min(50,s))}(n?.skills),d=function(e){if(!e||0===e.length)return 50;let a=e.map(e=>e.toLowerCase().trim()),i=0;for(let e of a)t.some(t=>e.includes(t)||t.includes(e))&&i++;let s=i/e.length;return s>=.7?85:s>=.5?70:s>=.3?55:s>0?45:40}(n?.targetCompanies),u=function(e){if(!e)return 50;let t=50;if(e.atsScore&&(t=.5*e.atsScore),e.keywords&&e.keywords.length>0){let i=e.keywords.map(e=>e.toLowerCase()),s=0;for(let e of i)a.some(t=>e.includes(t)||t.includes(e))&&s++;t+=Math.min(30,5*s)}if(e.analysis?.experienceLevel){let a=e.analysis.experienceLevel.toLowerCase();a.includes("senior")||a.includes("lead")||a.includes("principal")?t+=20:(a.includes("mid")||a.includes("intermediate"))&&(t+=10)}return Math.min(100,t)}(o),p=function(e){switch(e){case"easy":return 33;case"medium":return 66;case"hard":return 100;default:return 50}}(r),h=.3*l+.25*c+.2*d+.15*u+.1*p,m={experienceScore:Math.round(l),skillsScore:Math.round(c),companiesScore:Math.round(d),resumeScore:Math.round(u),selectedScore:Math.round(p),totalScore:Math.round(h)},g=h<40?"easy":h<70?"medium":"hard",f=50;return n?.yearsExperience&&(f+=15),n?.skills&&n.skills.length>0&&(f+=15),n?.targetCompanies&&n.targetCompanies.length>0&&(f+=10),o?.atsScore&&(f+=10),{calculatedDifficulty:g,confidenceScore:Math.min(100,f),adjustmentReason:function(e,t,a){if(e===t)return"Your selected difficulty matches your profile. No adjustment needed.";let i=[];return("hard"===e&&"hard"!==t?(a.experienceScore<50&&i.push("your experience level suggests building more foundation first"),a.skillsScore<50&&i.push("developing more system design skills would help"),a.resumeScore<50&&i.push("your resume indicates room for technical growth")):"easy"===e&&"easy"!==t&&(a.experienceScore>60&&i.push("your experience qualifies you for more challenge"),a.skillsScore>60&&i.push("your skills indicate strong system design knowledge"),a.companiesScore>70&&i.push("your target companies have rigorous interviews")),0===i.length)?`Adjusted from ${e} to ${t} based on your overall profile analysis.`:`Adjusted from ${e} to ${t} because ${i.join(" and ")}.`}(r,g,m),breakdown:m,recommendations:(s=[],m.experienceScore<40&&s.push("Focus on building practical experience with distributed systems"),m.skillsScore<50&&(s.push("Study core system design concepts: caching, sharding, load balancing"),s.push("Practice designing systems like URL shortener, rate limiter, chat app")),m.companiesScore>70&&m.totalScore<60&&(s.push("Your target companies have high bars - consider more preparation"),s.push("Review system design case studies from FAANG interviews")),m.resumeScore<50&&s.push("Update your resume to highlight system design experience"),(!n?.skills||n.skills.length<3)&&s.push("Add more skills to your profile for better question personalization"),0===s.length&&s.push("You're well-prepared! Focus on articulating your thoughts clearly"),s.slice(0,4))}}function s(e){switch(e){case"easy":return"Entry-level: Focus on fundamental concepts, provide hints when stuck, allow more time for thinking, cover basic system design patterns.";case"medium":return"Mid-level: Balance guidance with challenge, expect knowledge of common patterns, probe on trade-offs, moderate depth on scalability.";case"hard":return"Senior-level: Minimal hints, expect precise technical answers, deep-dive on edge cases, challenge all design decisions, cover advanced patterns.";default:return"Standard difficulty level."}}e.s(["calculateSmartDifficulty",()=>i,"getDifficultyDescription",()=>s])},21503,e=>{"use strict";var t=e.i(50760),a=e.i(12766);async function i(e){let i=function(e){let{topic:t,difficulty:i,profile:s,resume:r,followUpContext:n}=e,o=function(e){if(!e)return"No profile data available.";let t=[];return e.yearsExperience&&t.push(`Years of experience: ${e.yearsExperience}`),e.targetRole&&t.push(`Target role: ${e.targetRole}`),e.skills&&e.skills.length>0&&t.push(`Technical skills: ${e.skills.join(", ")}`),e.targetCompanies&&e.targetCompanies.length>0&&t.push(`Target companies: ${e.targetCompanies.join(", ")}`),e.bio&&t.push(`Background: ${e.bio}`),t.length>0?t.join("\n"):"Limited profile data available."}(s),l=function(e){if(!e)return"No resume data available.";let t=[];return e.atsScore&&t.push(`ATS Score: ${e.atsScore}/100`),e.keywords&&e.keywords.length>0&&t.push(`Key technical keywords: ${e.keywords.slice(0,15).join(", ")}`),e.predictedRoles&&e.predictedRoles.length>0&&t.push(`Predicted suitable roles: ${e.predictedRoles.join(", ")}`),e.analysis&&(e.analysis.experienceLevel&&t.push(`Experience level: ${e.analysis.experienceLevel}`),e.analysis.technicalDepth&&t.push(`Technical depth: ${e.analysis.technicalDepth}`),e.analysis.systemDesignExperience&&t.push(`System design experience: ${e.analysis.systemDesignExperience}`)),t.length>0?t.join("\n"):"Limited resume data available."}(r),c=(0,a.getDifficultyDescription)(i),d=function(e){if(!e||!e.hasHistory||0===e.weakPoints.length)return"";let t=`
## Candidate's Past Performance (Focus Areas)

This candidate has completed ${e.totalPastInterviews} previous interview${1===e.totalPastInterviews?"":"s"}.

**Weak Areas to Target:**
`;for(let a of e.weakPoints.slice(0,3))t+=`- **${a.dimension}**: scored ${a.lastScore}/4, trend: ${a.trend}
  - Probe deeper on: ${a.concept}
`;return e.conceptsToProbe.length>0&&(t+=`
**Specific Concepts to Include:**
${e.conceptsToProbe.map(e=>`- ${e}`).join("\n")}
`),e.topicsToReinforce.length>0&&(t+=`
**Related Topics With Low Performance:**
${e.topicsToReinforce.join(", ")}
`),t+=`
**Difficulty Adaptation:** ${e.adaptedDifficulty}
${"easier"===e.adaptedDifficulty?"- Generate more foundational questions with clear guidance":""}
${"harder"===e.adaptedDifficulty?"- Generate challenging edge cases and advanced scenarios":""}
`}(n);return`You are an expert system design interview question generator for top tech companies (FAANG+).

Generate a personalized set of system design interview questions for the topic: "${t}"

## Candidate Profile
${o}

## Resume Analysis
${l}

## Interview Parameters
- Difficulty Level: ${i.toUpperCase()}
- ${c}
- Total Interview Duration: 45 minutes
${d}
## Question Generation Guidelines

1. **Personalization**: Tailor questions to the candidate's skills and experience level.
   - If they have specific skills (e.g., Kafka, Redis), include questions that let them showcase these.
   - If they're targeting specific companies, align question style with those companies' interview patterns.

2. **Difficulty Calibration**:
   - EASY: Focus on fundamentals, basic patterns, straightforward requirements
   - MEDIUM: Include trade-off discussions, moderate scale, some edge cases
   - HARD: Complex scenarios, extreme scale, failure modes, advanced optimizations

3. **Coverage**: Questions should cover all phases:
   - Requirements Clarification (8 min): Scope, scale, constraints
   - High-Level Design (12 min): Architecture, components, data flow
   - Deep Dive (12 min): Specific component design, data models
   - Scalability (10 min): Growth, optimization, trade-offs
   - Trade-offs (3 min): Summary, alternatives considered

4. **Question Types to Include**:
   - Clarifying questions the interviewer should ask
   - Follow-up probes based on expected answers
   - Edge cases and failure scenarios
   - Scaling challenges specific to the system

## Output Format
Return a JSON object with the following structure:
{
  "questions": [
    {
      "id": "q1",
      "question": "The main question text",
      "category": "requirements|high-level|deep-dive|scalability|trade-offs",
      "difficulty": "easy|medium|hard",
      "focusAreas": ["area1", "area2"],
      "expectedTopics": ["topic candidate should mention"],
      "timeAllocation": 5
    }
  ],
  "focusAreas": ["Overall focus areas based on candidate profile"],
  "personalizationNotes": "How questions were personalized for this candidate",
  "interviewerContext": "Context for the AI interviewer about this candidate's background"
}

Generate 8-12 questions covering all categories. Ensure the total time allocation sums to approximately 45 minutes.`}(e);try{let a=await (0,t.ollamaChat)({messages:[{role:"system",content:"You are an expert system design interview question generator. Always respond with valid JSON only, no additional text."},{role:"user",content:i}],temperature:.7,max_tokens:2500}),s=a.message?.content||"",r=function(e){try{let t=e.match(/\{[\s\S]*\}/);if(t)return JSON.parse(t[0]);throw Error("No JSON found in response")}catch(e){return console.error("Failed to parse question response:",e),{questions:[],focusAreas:[],personalizationNotes:"Failed to generate personalized questions",interviewerContext:""}}}(s);return{topic:e.topic,difficulty:e.difficulty,totalDuration:45,questions:r.questions||[],focusAreas:r.focusAreas||[],personalizationNotes:r.personalizationNotes||"",interviewerContext:r.interviewerContext||""}}catch(t){return console.error("Ollama question generation error:",t),function(e){let{topic:t,difficulty:a}=e,i=[{id:"q1",question:`Let's design ${t}. Before we start, what clarifying questions would you like to ask about the requirements?`,category:"requirements",difficulty:a,focusAreas:["scope","constraints","users"],expectedTopics:["scale","features","non-functional requirements"],timeAllocation:8},{id:"q2",question:"Can you walk me through the high-level architecture? What are the main components?",category:"high-level",difficulty:a,focusAreas:["architecture","components"],expectedTopics:["clients","servers","databases","caches"],timeAllocation:12},{id:"q3",question:"Let's dive deeper into the data model. How would you structure the database?",category:"deep-dive",difficulty:a,focusAreas:["data modeling","storage"],expectedTopics:["tables","relationships","indexes"],timeAllocation:6},{id:"q4",question:"How would you handle the core functionality? Walk me through the main flow.",category:"deep-dive",difficulty:a,focusAreas:["implementation","algorithms"],expectedTopics:["API design","business logic"],timeAllocation:6},{id:"q5",question:"How would you scale this system to handle 10x or 100x the current load?",category:"scalability",difficulty:a,focusAreas:["scaling","performance"],expectedTopics:["horizontal scaling","caching","sharding"],timeAllocation:5},{id:"q6",question:"What are the potential bottlenecks and how would you address them?",category:"scalability",difficulty:a,focusAreas:["bottlenecks","optimization"],expectedTopics:["database","network","compute"],timeAllocation:5},{id:"q7",question:"What trade-offs did you make in your design? Would you change anything?",category:"trade-offs",difficulty:a,focusAreas:["trade-offs","alternatives"],expectedTopics:["consistency vs availability","cost vs performance"],timeAllocation:3}];return{topic:t,difficulty:a,totalDuration:45,questions:i,focusAreas:["System Design Fundamentals","Scalability","Trade-offs"],personalizationNotes:"Using standard question set due to limited personalization data",interviewerContext:`Interviewing for ${t} at ${a} difficulty level.`}}(e)}}e.s(["generatePersonalizedQuestions",()=>i])},47798,e=>e.a(async(t,a)=>{try{var i=e.i(97424),s=t([i]);[i]=s.then?(await s)():s;let n={struggling:{encouragementLevel:"high",challengeLevel:"gentle",hintFrequency:"frequent",probingDepth:"surface",paceAdjustment:"slower"},developing:{encouragementLevel:"moderate",challengeLevel:"gentle",hintFrequency:"occasional",probingDepth:"moderate",paceAdjustment:"standard"},proficient:{encouragementLevel:"moderate",challengeLevel:"standard",hintFrequency:"occasional",probingDepth:"moderate",paceAdjustment:"standard"},excelling:{encouragementLevel:"low",challengeLevel:"rigorous",hintFrequency:"rare",probingDepth:"deep",paceAdjustment:"faster"}};async function r(e){let t=await (0,i.calculatePerformanceMetrics)(e,10),a=(0,i.getPerformanceCategory)(t.overall.avgScore),s={...n[a]};"declining"===t.overall.scoreTrend&&"struggling"!==a&&(s.encouragementLevel="high",s.hintFrequency="occasional"),"improving"===t.overall.scoreTrend&&"struggling"===a&&(s.encouragementLevel="high",s.challengeLevel="gentle");let r=function(e,t,a){let i=`
## Bobby's Adapted Personality for This Candidate

Based on this candidate's performance history, adapt your interviewer behavior:

### Encouragement Style (${e.encouragementLevel})
`;switch(e.encouragementLevel){case"high":i+=`- Be extra supportive and positive
- Celebrate good points with phrases like "That's a great insight!" or "Excellent thinking!"
- When they struggle, say things like "That's okay, let me help guide you..."
- Focus on building confidence
`;break;case"moderate":i+=`- Acknowledge good points with brief praise like "Good" or "That works"
- Stay professional and constructive
- Offer encouragement when appropriate
`;break;case"low":i+=`- Focus on technical accuracy over praise
- Keep feedback objective and direct
- Save encouragement for truly exceptional answers
`}switch(i+=`
### Challenge Level (${e.challengeLevel})
`,e.challengeLevel){case"gentle":i+=`- Start with fundamental questions before advancing
- Break complex topics into smaller parts
- Give them time to think and don't rush
- If they struggle, simplify the question
`;break;case"standard":i+=`- Ask balanced questions that test understanding
- Probe on tradeoffs and alternatives
- Challenge decisions but accept reasonable answers
`;break;case"rigorous":i+=`- Push hard on edge cases and failure scenarios
- Ask follow-up questions that test depth
- Challenge assumptions and expect precise answers
- Don't accept vague answers - probe deeper
`}switch(i+=`
### Hints and Guidance (${e.hintFrequency})
`,e.hintFrequency){case"frequent":i+=`- Provide hints proactively when they seem stuck
- Offer suggestions like "Have you considered...?" or "What about...?"
- Guide them towards good solutions
`;break;case"occasional":i+=`- Give hints if they're clearly stuck after a reasonable attempt
- Let them work through problems independently first
`;break;case"rare":i+=`- Only hint if absolutely necessary
- Let them struggle and find solutions independently
- They should demonstrate they can problem-solve
`}switch(i+=`
### Probing Depth (${e.probingDepth})
`,e.probingDepth){case"surface":i+=`- Focus on high-level understanding
- Don't dive too deep into implementation details
- Accept general answers for complex topics
`;break;case"moderate":i+=`- Balance high-level and detailed questions
- Probe on important design decisions
`;break;case"deep":i+=`- Expect detailed explanations for all decisions
- Ask about implementation specifics, data structures, algorithms
- Test knowledge of edge cases and failure modes
`}return a.overall.completedInterviews>0&&(i+=`
### Performance Context
- Past interviews: ${a.overall.completedInterviews}
- Average score: ${a.overall.avgScore}/4.0
- Pass rate: ${a.overall.passRate}%
- Trend: ${a.overall.scoreTrend}
`),i}(s,0,t),o=function(e,t){if(0===t.overall.completedInterviews)return"First interview - using standard settings.";switch(e){case"struggling":return`Candidate's average score (${t.overall.avgScore}/4) indicates they need more support. Bobby will be more encouraging and provide more guidance.`;case"developing":return`Candidate is developing (${t.overall.avgScore}/4). Bobby will balance support with challenge.`;case"proficient":return`Candidate shows proficiency (${t.overall.avgScore}/4). Bobby will use standard interview approach.`;case"excelling":return`Candidate is excelling (${t.overall.avgScore}/4). Bobby will be more rigorous and challenging.`;default:return"Using standard interview settings."}}(a,t);return{settings:s,promptModifications:r,reasonForAdaptation:o,performanceCategory:a}}e.s(["calculatePersonalityAdaptation",()=>r]),a()}catch(e){a(e)}},!1),2993,e=>e.a(async(t,a)=>{try{var i=e.i(4575),s=e.i(63987),r=e.i(78968);e.i(3218);var n=e.i(15239),o=e.i(12766),l=e.i(21503),c=e.i(8783),d=e.i(47798),u=e.i(97424),p=e.i(46771),h=t([s,r,c,d,u,p]);async function m(e){try{let t=await (0,s.auth)();if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{topic:a,selectedDifficulty:h="medium"}=await e.json();if(!a)return i.NextResponse.json({error:"Topic is required"},{status:400});if(!["easy","medium","hard"].includes(h))return i.NextResponse.json({error:"Invalid difficulty level"},{status:400});let m=await r.prisma.profile.findUnique({where:{userId:t.user.id}}),g=await r.prisma.resume.findFirst({where:{userId:t.user.id},orderBy:{uploadedAt:"desc"}}),f=m?{yearsExperience:m.yearsExperience,skills:m.skills?JSON.parse(m.skills):[],targetCompanies:m.targetCompanies?JSON.parse(m.targetCompanies):[],targetRole:m.targetRole,bio:m.bio}:null,y=g?{content:g.content,atsScore:g.atsScore,keywords:g.keywords?JSON.parse(g.keywords):[],predictedRoles:g.predictedRoles?JSON.parse(g.predictedRoles):[],analysis:g.analysis?JSON.parse(g.analysis):null}:null,v=(0,o.calculateSmartDifficulty)({selectedDifficulty:h,profile:f,resume:y,topic:a}),w=v.calculatedDifficulty,[b,k,x]=await Promise.all([(0,u.calculatePerformanceMetrics)(t.user.id,15),(0,c.buildFollowUpContext)(t.user.id,a),(0,d.calculatePersonalityAdaptation)(t.user.id)]),S=await (0,l.generatePersonalizedQuestions)({topic:a,difficulty:w,profile:f,resume:y,followUpContext:k,userId:t.user.id}),R=(0,p.getPersonalizedInterviewPrompt)(a,w,x,k),A=await r.prisma.interview.create({data:{userId:t.user.id,topic:a,difficulty:w,status:"in_progress",startedAt:new Date}}),C=(await (0,n.complete)({messages:[{role:"system",content:R},{role:"user",content:"Start the interview."}],maxTokens:500,temperature:.7})).content||`Hey there! I'm Bobby, and I'll be your interviewer today. I'm excited to discuss ${a} with you! Let's start with some clarifying questions - what's the first thing you'd want to understand about the requirements?`;return await r.prisma.message.createMany({data:[{interviewId:A.id,role:"system",content:R},{interviewId:A.id,role:"assistant",content:C}]}),i.NextResponse.json({success:!0,interview:{id:A.id,topic:A.topic,difficulty:A.difficulty,status:A.status,startedAt:A.startedAt},initialMessage:C,personalization:{selectedDifficulty:h,calculatedDifficulty:w,wasAdjusted:h!==w,adjustmentReason:v.adjustmentReason,confidenceScore:v.confidenceScore,breakdown:v.breakdown,recommendations:v.recommendations,performanceCategory:x.performanceCategory,personalityAdaptation:x.reasonForAdaptation,weakAreasTargeted:k.weakPoints.map(e=>e.dimension),hasHistory:k.hasHistory,totalPastInterviews:k.totalPastInterviews,adaptedDifficulty:k.adaptedDifficulty},questionSet:{focusAreas:S.focusAreas,personalizationNotes:S.personalizationNotes,questionCount:S.questions.length},performanceContext:{avgScore:b.overall.avgScore,passRate:b.overall.passRate,scoreTrend:b.overall.scoreTrend,completedInterviews:b.overall.completedInterviews}})}catch(e){return console.error("Personalized interview creation error:",e),i.NextResponse.json({error:"Failed to create personalized interview"},{status:500})}}async function g(e){try{let t=await (0,s.auth)();if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),n=a.get("difficulty")||"medium",l=a.get("topic")||"System Design",c=await r.prisma.profile.findUnique({where:{userId:t.user.id}}),d=await r.prisma.resume.findFirst({where:{userId:t.user.id},orderBy:{uploadedAt:"desc"}}),u=c?{yearsExperience:c.yearsExperience,skills:c.skills?JSON.parse(c.skills):[],targetCompanies:c.targetCompanies?JSON.parse(c.targetCompanies):[],targetRole:c.targetRole,bio:c.bio}:null,p=d?{content:d.content,atsScore:d.atsScore,keywords:d.keywords?JSON.parse(d.keywords):[],predictedRoles:d.predictedRoles?JSON.parse(d.predictedRoles):[],analysis:d.analysis?JSON.parse(d.analysis):null}:null,h=(0,o.calculateSmartDifficulty)({selectedDifficulty:n,profile:u,resume:p,topic:l});return i.NextResponse.json({selectedDifficulty:n,calculatedDifficulty:h.calculatedDifficulty,wasAdjusted:n!==h.calculatedDifficulty,adjustmentReason:h.adjustmentReason,confidenceScore:h.confidenceScore,breakdown:h.breakdown,recommendations:h.recommendations,profileSummary:{hasProfile:!!c,hasResume:!!d,yearsExperience:u?.yearsExperience||null,skillsCount:u?.skills?.length||0,targetCompaniesCount:u?.targetCompanies?.length||0}})}catch(e){return console.error("Difficulty preview error:",e),i.NextResponse.json({error:"Failed to calculate difficulty"},{status:500})}}[s,r,c,d,u,p]=h.then?(await h)():h,e.s(["GET",()=>g,"POST",()=>m]),a()}catch(e){a(e)}},!1),28226,e=>e.a(async(t,a)=>{try{var i=e.i(98496),s=e.i(21818),r=e.i(78262),n=e.i(75769),o=e.i(93054),l=e.i(71202),c=e.i(72708),d=e.i(79667),u=e.i(96273),p=e.i(71884),h=e.i(61992),m=e.i(4474),g=e.i(10540),f=e.i(6262),y=e.i(86862),v=e.i(93695);e.i(17296);var w=e.i(74035),b=e.i(2993),k=t([b]);[b]=k.then?(await k)():k;let R=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/interview/personalized/route",pathname:"/api/interview/personalized",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Documents/Git/system-design/system-design-simulator/src/app/api/interview/personalized/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:A,workUnitAsyncStorage:C,serverHooks:q}=R;function x(){return(0,r.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:C})}async function S(e,t,a){R.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/interview/personalized/route";i=i.replace(/\/index$/,"")||"/";let r=await R.prepare(e,t,{srcPage:i,multiZoneDraftMode:!1});if(!r)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:b,params:k,nextConfig:x,parsedUrl:S,isDraftMode:A,prerenderManifest:C,routerServerContext:q,isOnDemandRevalidate:T,revalidateOnlyGenerated:E,resolvedPathname:P,clientReferenceManifest:D,serverActionsManifest:$}=r,N=(0,c.normalizeAppPath)(i),I=!!(C.dynamicRoutes[N]||C.routes[P]),j=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,S,!1):t.end("This page could not be found"),null);if(I&&!A){let e=!!C.routes[P],t=C.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await j();throw new v.NoFallbackError}}let O=null;!I||R.isDev||A||(O=P,O="/index"===O?"/":O);let L=!0===R.isDev||!I,F=I&&!L;$&&D&&(0,l.setManifestsSingleton)({page:i,clientReferenceManifest:D,serverActionsManifest:$});let z=e.method||"GET",M=(0,o.getTracer)(),H=M.getActiveScopeSpan(),U={params:k,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,i,s)=>R.onRequestError(e,t,i,s,q)},sharedContext:{buildId:b}},_=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(_,(0,u.signalFromNodeResponse)(t));try{let r=async e=>R.handle(G,U).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=a.get("next.route");if(s){let t=`${z} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${z} ${i}`)}),l=!!(0,n.getRequestMeta)(e,"minimalMode"),c=async n=>{var o,c;let d=async({previousCacheEntry:s})=>{try{if(!l&&T&&E&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(n);e.fetchMetrics=U.renderOpts.fetchMetrics;let o=U.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let c=U.renderOpts.collectedTags;if(!I)return await (0,m.sendResponse)(_,B,i,U.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==U.renderOpts.collectedRevalidate&&!(U.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&U.renderOpts.collectedRevalidate,s=void 0===U.renderOpts.collectedExpire||U.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:U.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await R.onRequestError(e,t,{routerKind:"App Router",routePath:i,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:T})},!1,q),t}},u=await R.handleResponse({req:e,nextConfig:x,cacheKey:O,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:E,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:l});if(!I)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&I||p.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(_,B,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};H?await c(H):await M.withPropagatedContext(e.headers,()=>M.trace(p.BaseServerSpan.handleRequest,{spanName:`${z} ${i}`,kind:o.SpanKind.SERVER,attributes:{"http.method":z,"http.target":e.url}},c))}catch(t){if(t instanceof v.NoFallbackError||await R.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:T})},!1,q),I)throw t;return await (0,m.sendResponse)(_,B,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>x,"routeModule",()=>R,"serverHooks",()=>q,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>C]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=Documents_Git_system-design_system-design-simulator_fc61818c._.js.map