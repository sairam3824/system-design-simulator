{"version":3,"sources":["../../../../../../../Documents/Git/system-design/system-design-simulator/src/lib/difficulty-calculator.ts","../../../../../../../Documents/Git/system-design/system-design-simulator/src/lib/question-generator.ts","../../../../../../../Documents/Git/system-design/system-design-simulator/src/lib/ai-personality-adapter.ts","../../../../../../../Documents/Git/system-design/system-design-simulator/src/app/api/interview/personalized/route.ts","../../../../../../../Documents/Git/system-design/system-design-simulator/node_modules/next/src/build/templates/app-route.ts"],"sourcesContent":["/**\n * Smart Difficulty Calculator\n *\n * Calculates the actual interview difficulty based on user profile,\n * skills, experience, target companies, and resume analysis.\n *\n * Weightages:\n * - Experience Level: 30%\n * - Skills Match: 25%\n * - Target Companies: 20%\n * - Resume Analysis: 15%\n * - Selected Difficulty: 10%\n */\n\nexport type DifficultyLevel = \"easy\" | \"medium\" | \"hard\";\n\nexport interface UserProfileData {\n  yearsExperience?: number | null;\n  skills?: string[];\n  targetCompanies?: string[];\n  targetRole?: string | null;\n  bio?: string | null;\n}\n\nexport interface ResumeData {\n  content?: string | null;\n  atsScore?: number | null;\n  keywords?: string[];\n  predictedRoles?: string[];\n  analysis?: {\n    experienceLevel?: string;\n    technicalDepth?: string;\n    systemDesignExperience?: string;\n  } | null;\n}\n\nexport interface DifficultyInput {\n  selectedDifficulty: DifficultyLevel;\n  profile: UserProfileData | null;\n  resume: ResumeData | null;\n  topic: string;\n}\n\nexport interface DifficultyResult {\n  calculatedDifficulty: DifficultyLevel;\n  confidenceScore: number;\n  adjustmentReason: string;\n  breakdown: {\n    experienceScore: number;\n    skillsScore: number;\n    companiesScore: number;\n    resumeScore: number;\n    selectedScore: number;\n    totalScore: number;\n  };\n  recommendations: string[];\n}\n\n// Weightages for each factor\nconst WEIGHTS = {\n  experience: 0.30,\n  skills: 0.25,\n  companies: 0.20,\n  resume: 0.15,\n  selected: 0.10,\n};\n\n// FAANG and top-tier companies (require higher difficulty)\nconst TOP_TIER_COMPANIES = [\n  \"google\", \"meta\", \"facebook\", \"amazon\", \"apple\", \"microsoft\", \"netflix\",\n  \"uber\", \"airbnb\", \"stripe\", \"coinbase\", \"linkedin\", \"twitter\", \"x\",\n  \"openai\", \"anthropic\", \"databricks\", \"snowflake\", \"palantir\", \"nvidia\",\n  \"tesla\", \"spacex\", \"bloomberg\", \"citadel\", \"two sigma\", \"jane street\",\n  \"bytedance\", \"tiktok\", \"spotify\", \"dropbox\", \"slack\", \"salesforce\"\n];\n\n// System design related skills\nconst SYSTEM_DESIGN_SKILLS = [\n  \"system design\", \"distributed systems\", \"microservices\", \"kubernetes\", \"docker\",\n  \"aws\", \"gcp\", \"azure\", \"kafka\", \"redis\", \"elasticsearch\", \"mongodb\",\n  \"postgresql\", \"mysql\", \"cassandra\", \"dynamodb\", \"graphql\", \"rest api\",\n  \"load balancing\", \"caching\", \"sharding\", \"replication\", \"cap theorem\",\n  \"event-driven\", \"message queues\", \"rabbitmq\", \"grpc\", \"websockets\",\n  \"cdn\", \"api gateway\", \"service mesh\", \"istio\", \"terraform\", \"ci/cd\",\n  \"scalability\", \"high availability\", \"fault tolerance\", \"database design\"\n];\n\n/**\n * Calculate experience score (0-100)\n * 0-2 years: Beginner (20-40)\n * 3-5 years: Intermediate (40-60)\n * 6-10 years: Senior (60-80)\n * 10+ years: Expert (80-100)\n */\nfunction calculateExperienceScore(yearsExperience?: number | null): number {\n  if (!yearsExperience || yearsExperience <= 0) return 20;\n\n  if (yearsExperience <= 2) {\n    return 20 + (yearsExperience / 2) * 20; // 20-40\n  } else if (yearsExperience <= 5) {\n    return 40 + ((yearsExperience - 2) / 3) * 20; // 40-60\n  } else if (yearsExperience <= 10) {\n    return 60 + ((yearsExperience - 5) / 5) * 20; // 60-80\n  } else {\n    return Math.min(100, 80 + ((yearsExperience - 10) / 10) * 20); // 80-100\n  }\n}\n\n/**\n * Calculate skills score based on system design relevant skills (0-100)\n */\nfunction calculateSkillsScore(skills?: string[]): number {\n  if (!skills || skills.length === 0) return 30;\n\n  const normalizedSkills = skills.map(s => s.toLowerCase().trim());\n\n  let matchCount = 0;\n  let totalRelevance = 0;\n\n  for (const skill of normalizedSkills) {\n    for (const sdSkill of SYSTEM_DESIGN_SKILLS) {\n      if (skill.includes(sdSkill) || sdSkill.includes(skill)) {\n        matchCount++;\n        // Some skills are more advanced\n        if ([\"distributed systems\", \"cap theorem\", \"sharding\", \"service mesh\", \"event-driven\"].some(s => skill.includes(s))) {\n          totalRelevance += 15;\n        } else if ([\"kubernetes\", \"kafka\", \"elasticsearch\", \"microservices\"].some(s => skill.includes(s))) {\n          totalRelevance += 12;\n        } else {\n          totalRelevance += 8;\n        }\n        break;\n      }\n    }\n  }\n\n  // Base score from match count\n  const matchScore = Math.min(50, matchCount * 10);\n  // Relevance bonus\n  const relevanceScore = Math.min(50, totalRelevance);\n\n  return Math.min(100, matchScore + relevanceScore);\n}\n\n/**\n * Calculate company tier score (0-100)\n * Top-tier companies expect higher difficulty\n */\nfunction calculateCompaniesScore(targetCompanies?: string[]): number {\n  if (!targetCompanies || targetCompanies.length === 0) return 50;\n\n  const normalizedCompanies = targetCompanies.map(c => c.toLowerCase().trim());\n\n  let topTierCount = 0;\n  for (const company of normalizedCompanies) {\n    if (TOP_TIER_COMPANIES.some(tc => company.includes(tc) || tc.includes(company))) {\n      topTierCount++;\n    }\n  }\n\n  const topTierRatio = topTierCount / targetCompanies.length;\n\n  // If mostly top-tier companies, expect higher difficulty\n  if (topTierRatio >= 0.7) return 85;\n  if (topTierRatio >= 0.5) return 70;\n  if (topTierRatio >= 0.3) return 55;\n  if (topTierRatio > 0) return 45;\n\n  return 40;\n}\n\n/**\n * Calculate resume score based on ATS analysis (0-100)\n */\nfunction calculateResumeScore(resume?: ResumeData | null): number {\n  if (!resume) return 50;\n\n  let score = 50;\n\n  // ATS score contribution\n  if (resume.atsScore) {\n    score = resume.atsScore * 0.5;\n  }\n\n  // Keywords analysis\n  if (resume.keywords && resume.keywords.length > 0) {\n    const normalizedKeywords = resume.keywords.map(k => k.toLowerCase());\n    let relevantKeywords = 0;\n\n    for (const keyword of normalizedKeywords) {\n      if (SYSTEM_DESIGN_SKILLS.some(s => keyword.includes(s) || s.includes(keyword))) {\n        relevantKeywords++;\n      }\n    }\n\n    score += Math.min(30, relevantKeywords * 5);\n  }\n\n  // Experience level from analysis\n  if (resume.analysis?.experienceLevel) {\n    const level = resume.analysis.experienceLevel.toLowerCase();\n    if (level.includes(\"senior\") || level.includes(\"lead\") || level.includes(\"principal\")) {\n      score += 20;\n    } else if (level.includes(\"mid\") || level.includes(\"intermediate\")) {\n      score += 10;\n    }\n  }\n\n  return Math.min(100, score);\n}\n\n/**\n * Convert selected difficulty to score (0-100)\n */\nfunction selectedDifficultyToScore(difficulty: DifficultyLevel): number {\n  switch (difficulty) {\n    case \"easy\": return 33;\n    case \"medium\": return 66;\n    case \"hard\": return 100;\n    default: return 50;\n  }\n}\n\n/**\n * Convert total score to difficulty level\n */\nfunction scoreToDifficulty(score: number): DifficultyLevel {\n  if (score < 40) return \"easy\";\n  if (score < 70) return \"medium\";\n  return \"hard\";\n}\n\n/**\n * Generate adjustment reason based on the calculation\n */\nfunction generateAdjustmentReason(\n  selected: DifficultyLevel,\n  calculated: DifficultyLevel,\n  breakdown: DifficultyResult[\"breakdown\"]\n): string {\n  if (selected === calculated) {\n    return \"Your selected difficulty matches your profile. No adjustment needed.\";\n  }\n\n  const reasons: string[] = [];\n\n  if (selected === \"hard\" && calculated !== \"hard\") {\n    if (breakdown.experienceScore < 50) {\n      reasons.push(\"your experience level suggests building more foundation first\");\n    }\n    if (breakdown.skillsScore < 50) {\n      reasons.push(\"developing more system design skills would help\");\n    }\n    if (breakdown.resumeScore < 50) {\n      reasons.push(\"your resume indicates room for technical growth\");\n    }\n  } else if (selected === \"easy\" && calculated !== \"easy\") {\n    if (breakdown.experienceScore > 60) {\n      reasons.push(\"your experience qualifies you for more challenge\");\n    }\n    if (breakdown.skillsScore > 60) {\n      reasons.push(\"your skills indicate strong system design knowledge\");\n    }\n    if (breakdown.companiesScore > 70) {\n      reasons.push(\"your target companies have rigorous interviews\");\n    }\n  }\n\n  if (reasons.length === 0) {\n    return `Adjusted from ${selected} to ${calculated} based on your overall profile analysis.`;\n  }\n\n  return `Adjusted from ${selected} to ${calculated} because ${reasons.join(\" and \")}.`;\n}\n\n/**\n * Generate recommendations based on profile analysis\n */\nfunction generateRecommendations(\n  breakdown: DifficultyResult[\"breakdown\"],\n  profile: UserProfileData | null\n): string[] {\n  const recommendations: string[] = [];\n\n  if (breakdown.experienceScore < 40) {\n    recommendations.push(\"Focus on building practical experience with distributed systems\");\n  }\n\n  if (breakdown.skillsScore < 50) {\n    recommendations.push(\"Study core system design concepts: caching, sharding, load balancing\");\n    recommendations.push(\"Practice designing systems like URL shortener, rate limiter, chat app\");\n  }\n\n  if (breakdown.companiesScore > 70 && breakdown.totalScore < 60) {\n    recommendations.push(\"Your target companies have high bars - consider more preparation\");\n    recommendations.push(\"Review system design case studies from FAANG interviews\");\n  }\n\n  if (breakdown.resumeScore < 50) {\n    recommendations.push(\"Update your resume to highlight system design experience\");\n  }\n\n  if (!profile?.skills || profile.skills.length < 3) {\n    recommendations.push(\"Add more skills to your profile for better question personalization\");\n  }\n\n  if (recommendations.length === 0) {\n    recommendations.push(\"You're well-prepared! Focus on articulating your thoughts clearly\");\n  }\n\n  return recommendations.slice(0, 4);\n}\n\n/**\n * Main function: Calculate smart difficulty\n */\nexport function calculateSmartDifficulty(input: DifficultyInput): DifficultyResult {\n  const { selectedDifficulty, profile, resume } = input;\n\n  // Calculate individual scores\n  const experienceScore = calculateExperienceScore(profile?.yearsExperience);\n  const skillsScore = calculateSkillsScore(profile?.skills);\n  const companiesScore = calculateCompaniesScore(profile?.targetCompanies);\n  const resumeScore = calculateResumeScore(resume);\n  const selectedScore = selectedDifficultyToScore(selectedDifficulty);\n\n  // Calculate weighted total\n  const totalScore =\n    experienceScore * WEIGHTS.experience +\n    skillsScore * WEIGHTS.skills +\n    companiesScore * WEIGHTS.companies +\n    resumeScore * WEIGHTS.resume +\n    selectedScore * WEIGHTS.selected;\n\n  const breakdown = {\n    experienceScore: Math.round(experienceScore),\n    skillsScore: Math.round(skillsScore),\n    companiesScore: Math.round(companiesScore),\n    resumeScore: Math.round(resumeScore),\n    selectedScore: Math.round(selectedScore),\n    totalScore: Math.round(totalScore),\n  };\n\n  const calculatedDifficulty = scoreToDifficulty(totalScore);\n\n  // Confidence score based on how much data we have\n  let confidenceScore = 50;\n  if (profile?.yearsExperience) confidenceScore += 15;\n  if (profile?.skills && profile.skills.length > 0) confidenceScore += 15;\n  if (profile?.targetCompanies && profile.targetCompanies.length > 0) confidenceScore += 10;\n  if (resume?.atsScore) confidenceScore += 10;\n\n  return {\n    calculatedDifficulty,\n    confidenceScore: Math.min(100, confidenceScore),\n    adjustmentReason: generateAdjustmentReason(selectedDifficulty, calculatedDifficulty, breakdown),\n    breakdown,\n    recommendations: generateRecommendations(breakdown, profile),\n  };\n}\n\n/**\n * Get difficulty description for prompts\n */\nexport function getDifficultyDescription(difficulty: DifficultyLevel): string {\n  switch (difficulty) {\n    case \"easy\":\n      return \"Entry-level: Focus on fundamental concepts, provide hints when stuck, allow more time for thinking, cover basic system design patterns.\";\n    case \"medium\":\n      return \"Mid-level: Balance guidance with challenge, expect knowledge of common patterns, probe on trade-offs, moderate depth on scalability.\";\n    case \"hard\":\n      return \"Senior-level: Minimal hints, expect precise technical answers, deep-dive on edge cases, challenge all design decisions, cover advanced patterns.\";\n    default:\n      return \"Standard difficulty level.\";\n  }\n}\n","/**\n * Personalized Question Generator\n *\n * Uses Ollama (local LLM) to generate interview questions tailored to user's profile,\n * skills, experience, and target companies.\n */\n\nimport { ollamaChat } from \"./ollama\";\nimport {\n  DifficultyLevel,\n  UserProfileData,\n  ResumeData,\n  getDifficultyDescription,\n} from \"./difficulty-calculator\";\nimport { FollowUpContext } from \"./followup-engine\";\n\nexport interface QuestionGeneratorInput {\n  topic: string;\n  difficulty: DifficultyLevel;\n  profile: UserProfileData | null;\n  resume: ResumeData | null;\n  followUpContext?: FollowUpContext;\n  userId?: string;\n}\n\nexport interface GeneratedQuestion {\n  id: string;\n  question: string;\n  category: \"requirements\" | \"high-level\" | \"deep-dive\" | \"scalability\" | \"trade-offs\";\n  difficulty: DifficultyLevel;\n  focusAreas: string[];\n  expectedTopics: string[];\n  timeAllocation: number; // minutes\n}\n\nexport interface PersonalizedQuestionSet {\n  topic: string;\n  difficulty: DifficultyLevel;\n  totalDuration: number;\n  questions: GeneratedQuestion[];\n  focusAreas: string[];\n  personalizationNotes: string;\n  interviewerContext: string;\n}\n\n/**\n * Build context string from user profile\n */\nfunction buildProfileContext(profile: UserProfileData | null): string {\n  if (!profile) return \"No profile data available.\";\n\n  const parts: string[] = [];\n\n  if (profile.yearsExperience) {\n    parts.push(`Years of experience: ${profile.yearsExperience}`);\n  }\n\n  if (profile.targetRole) {\n    parts.push(`Target role: ${profile.targetRole}`);\n  }\n\n  if (profile.skills && profile.skills.length > 0) {\n    parts.push(`Technical skills: ${profile.skills.join(\", \")}`);\n  }\n\n  if (profile.targetCompanies && profile.targetCompanies.length > 0) {\n    parts.push(`Target companies: ${profile.targetCompanies.join(\", \")}`);\n  }\n\n  if (profile.bio) {\n    parts.push(`Background: ${profile.bio}`);\n  }\n\n  return parts.length > 0 ? parts.join(\"\\n\") : \"Limited profile data available.\";\n}\n\n/**\n * Build context string from resume\n */\nfunction buildResumeContext(resume: ResumeData | null): string {\n  if (!resume) return \"No resume data available.\";\n\n  const parts: string[] = [];\n\n  if (resume.atsScore) {\n    parts.push(`ATS Score: ${resume.atsScore}/100`);\n  }\n\n  if (resume.keywords && resume.keywords.length > 0) {\n    parts.push(`Key technical keywords: ${resume.keywords.slice(0, 15).join(\", \")}`);\n  }\n\n  if (resume.predictedRoles && resume.predictedRoles.length > 0) {\n    parts.push(`Predicted suitable roles: ${resume.predictedRoles.join(\", \")}`);\n  }\n\n  if (resume.analysis) {\n    if (resume.analysis.experienceLevel) {\n      parts.push(`Experience level: ${resume.analysis.experienceLevel}`);\n    }\n    if (resume.analysis.technicalDepth) {\n      parts.push(`Technical depth: ${resume.analysis.technicalDepth}`);\n    }\n    if (resume.analysis.systemDesignExperience) {\n      parts.push(`System design experience: ${resume.analysis.systemDesignExperience}`);\n    }\n  }\n\n  return parts.length > 0 ? parts.join(\"\\n\") : \"Limited resume data available.\";\n}\n\n/**\n * Build weak areas context for follow-up questioning\n */\nfunction buildWeakAreasContext(followUpContext?: FollowUpContext): string {\n  if (!followUpContext || !followUpContext.hasHistory || followUpContext.weakPoints.length === 0) {\n    return \"\";\n  }\n\n  let context = `\n## Candidate's Past Performance (Focus Areas)\n\nThis candidate has completed ${followUpContext.totalPastInterviews} previous interview${followUpContext.totalPastInterviews === 1 ? \"\" : \"s\"}.\n\n**Weak Areas to Target:**\n`;\n\n  for (const wp of followUpContext.weakPoints.slice(0, 3)) {\n    context += `- **${wp.dimension}**: scored ${wp.lastScore}/4, trend: ${wp.trend}\n  - Probe deeper on: ${wp.concept}\n`;\n  }\n\n  if (followUpContext.conceptsToProbe.length > 0) {\n    context += `\n**Specific Concepts to Include:**\n${followUpContext.conceptsToProbe.map(c => `- ${c}`).join(\"\\n\")}\n`;\n  }\n\n  if (followUpContext.topicsToReinforce.length > 0) {\n    context += `\n**Related Topics With Low Performance:**\n${followUpContext.topicsToReinforce.join(\", \")}\n`;\n  }\n\n  context += `\n**Difficulty Adaptation:** ${followUpContext.adaptedDifficulty}\n${followUpContext.adaptedDifficulty === \"easier\" ? \"- Generate more foundational questions with clear guidance\" : \"\"}\n${followUpContext.adaptedDifficulty === \"harder\" ? \"- Generate challenging edge cases and advanced scenarios\" : \"\"}\n`;\n\n  return context;\n}\n\n/**\n * Generate the question generation prompt\n */\nfunction buildQuestionPrompt(input: QuestionGeneratorInput): string {\n  const { topic, difficulty, profile, resume, followUpContext } = input;\n\n  const profileContext = buildProfileContext(profile);\n  const resumeContext = buildResumeContext(resume);\n  const difficultyDesc = getDifficultyDescription(difficulty);\n  const weakAreasContext = buildWeakAreasContext(followUpContext);\n\n  return `You are an expert system design interview question generator for top tech companies (FAANG+).\n\nGenerate a personalized set of system design interview questions for the topic: \"${topic}\"\n\n## Candidate Profile\n${profileContext}\n\n## Resume Analysis\n${resumeContext}\n\n## Interview Parameters\n- Difficulty Level: ${difficulty.toUpperCase()}\n- ${difficultyDesc}\n- Total Interview Duration: 45 minutes\n${weakAreasContext}\n## Question Generation Guidelines\n\n1. **Personalization**: Tailor questions to the candidate's skills and experience level.\n   - If they have specific skills (e.g., Kafka, Redis), include questions that let them showcase these.\n   - If they're targeting specific companies, align question style with those companies' interview patterns.\n\n2. **Difficulty Calibration**:\n   - EASY: Focus on fundamentals, basic patterns, straightforward requirements\n   - MEDIUM: Include trade-off discussions, moderate scale, some edge cases\n   - HARD: Complex scenarios, extreme scale, failure modes, advanced optimizations\n\n3. **Coverage**: Questions should cover all phases:\n   - Requirements Clarification (8 min): Scope, scale, constraints\n   - High-Level Design (12 min): Architecture, components, data flow\n   - Deep Dive (12 min): Specific component design, data models\n   - Scalability (10 min): Growth, optimization, trade-offs\n   - Trade-offs (3 min): Summary, alternatives considered\n\n4. **Question Types to Include**:\n   - Clarifying questions the interviewer should ask\n   - Follow-up probes based on expected answers\n   - Edge cases and failure scenarios\n   - Scaling challenges specific to the system\n\n## Output Format\nReturn a JSON object with the following structure:\n{\n  \"questions\": [\n    {\n      \"id\": \"q1\",\n      \"question\": \"The main question text\",\n      \"category\": \"requirements|high-level|deep-dive|scalability|trade-offs\",\n      \"difficulty\": \"easy|medium|hard\",\n      \"focusAreas\": [\"area1\", \"area2\"],\n      \"expectedTopics\": [\"topic candidate should mention\"],\n      \"timeAllocation\": 5\n    }\n  ],\n  \"focusAreas\": [\"Overall focus areas based on candidate profile\"],\n  \"personalizationNotes\": \"How questions were personalized for this candidate\",\n  \"interviewerContext\": \"Context for the AI interviewer about this candidate's background\"\n}\n\nGenerate 8-12 questions covering all categories. Ensure the total time allocation sums to approximately 45 minutes.`;\n}\n\n/**\n * Parse OpenAI response into structured format\n */\nfunction parseQuestionResponse(response: string): Partial<PersonalizedQuestionSet> {\n  try {\n    // Try to extract JSON from the response\n    const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      return JSON.parse(jsonMatch[0]);\n    }\n    throw new Error(\"No JSON found in response\");\n  } catch (error) {\n    console.error(\"Failed to parse question response:\", error);\n    return {\n      questions: [],\n      focusAreas: [],\n      personalizationNotes: \"Failed to generate personalized questions\",\n      interviewerContext: \"\",\n    };\n  }\n}\n\n/**\n * Generate personalized questions using Ollama (local LLM)\n */\nexport async function generatePersonalizedQuestions(\n  input: QuestionGeneratorInput\n): Promise<PersonalizedQuestionSet> {\n  const prompt = buildQuestionPrompt(input);\n\n  try {\n    const completion = await ollamaChat({\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are an expert system design interview question generator. Always respond with valid JSON only, no additional text.\",\n        },\n        {\n          role: \"user\",\n          content: prompt,\n        },\n      ],\n      temperature: 0.7,\n      max_tokens: 2500,\n    });\n\n    const responseText = completion.message?.content || \"\";\n    const parsed = parseQuestionResponse(responseText);\n\n    return {\n      topic: input.topic,\n      difficulty: input.difficulty,\n      totalDuration: 45,\n      questions: parsed.questions || [],\n      focusAreas: parsed.focusAreas || [],\n      personalizationNotes: parsed.personalizationNotes || \"\",\n      interviewerContext: parsed.interviewerContext || \"\",\n    };\n  } catch (error) {\n    console.error(\"Ollama question generation error:\", error);\n\n    // Return fallback questions\n    return generateFallbackQuestions(input);\n  }\n}\n\n/**\n * Generate fallback questions if Ollama fails\n */\nfunction generateFallbackQuestions(input: QuestionGeneratorInput): PersonalizedQuestionSet {\n  const { topic, difficulty } = input;\n\n  const baseQuestions: GeneratedQuestion[] = [\n    {\n      id: \"q1\",\n      question: `Let's design ${topic}. Before we start, what clarifying questions would you like to ask about the requirements?`,\n      category: \"requirements\",\n      difficulty,\n      focusAreas: [\"scope\", \"constraints\", \"users\"],\n      expectedTopics: [\"scale\", \"features\", \"non-functional requirements\"],\n      timeAllocation: 8,\n    },\n    {\n      id: \"q2\",\n      question: \"Can you walk me through the high-level architecture? What are the main components?\",\n      category: \"high-level\",\n      difficulty,\n      focusAreas: [\"architecture\", \"components\"],\n      expectedTopics: [\"clients\", \"servers\", \"databases\", \"caches\"],\n      timeAllocation: 12,\n    },\n    {\n      id: \"q3\",\n      question: \"Let's dive deeper into the data model. How would you structure the database?\",\n      category: \"deep-dive\",\n      difficulty,\n      focusAreas: [\"data modeling\", \"storage\"],\n      expectedTopics: [\"tables\", \"relationships\", \"indexes\"],\n      timeAllocation: 6,\n    },\n    {\n      id: \"q4\",\n      question: \"How would you handle the core functionality? Walk me through the main flow.\",\n      category: \"deep-dive\",\n      difficulty,\n      focusAreas: [\"implementation\", \"algorithms\"],\n      expectedTopics: [\"API design\", \"business logic\"],\n      timeAllocation: 6,\n    },\n    {\n      id: \"q5\",\n      question: \"How would you scale this system to handle 10x or 100x the current load?\",\n      category: \"scalability\",\n      difficulty,\n      focusAreas: [\"scaling\", \"performance\"],\n      expectedTopics: [\"horizontal scaling\", \"caching\", \"sharding\"],\n      timeAllocation: 5,\n    },\n    {\n      id: \"q6\",\n      question: \"What are the potential bottlenecks and how would you address them?\",\n      category: \"scalability\",\n      difficulty,\n      focusAreas: [\"bottlenecks\", \"optimization\"],\n      expectedTopics: [\"database\", \"network\", \"compute\"],\n      timeAllocation: 5,\n    },\n    {\n      id: \"q7\",\n      question: \"What trade-offs did you make in your design? Would you change anything?\",\n      category: \"trade-offs\",\n      difficulty,\n      focusAreas: [\"trade-offs\", \"alternatives\"],\n      expectedTopics: [\"consistency vs availability\", \"cost vs performance\"],\n      timeAllocation: 3,\n    },\n  ];\n\n  return {\n    topic,\n    difficulty,\n    totalDuration: 45,\n    questions: baseQuestions,\n    focusAreas: [\"System Design Fundamentals\", \"Scalability\", \"Trade-offs\"],\n    personalizationNotes: \"Using standard question set due to limited personalization data\",\n    interviewerContext: `Interviewing for ${topic} at ${difficulty} difficulty level.`,\n  };\n}\n\n/**\n * Build enhanced interviewer prompt with personalization\n */\nexport function buildPersonalizedInterviewerPrompt(\n  questionSet: PersonalizedQuestionSet,\n  profile: UserProfileData | null\n): string {\n  const { topic, difficulty, interviewerContext, focusAreas, personalizationNotes } = questionSet;\n\n  const skillsContext = profile?.skills?.length\n    ? `The candidate has experience with: ${profile.skills.join(\", \")}.`\n    : \"\";\n\n  const experienceContext = profile?.yearsExperience\n    ? `They have ${profile.yearsExperience} years of experience.`\n    : \"\";\n\n  const companiesContext = profile?.targetCompanies?.length\n    ? `They are targeting companies like: ${profile.targetCompanies.join(\", \")}.`\n    : \"\";\n\n  return `You are Bobby, a friendly and experienced senior software engineer conducting a 45-minute system design interview at a top tech company. You have 10+ years of experience building large-scale distributed systems.\n\n## Interview Topic: ${topic}\n## Difficulty: ${difficulty.toUpperCase()}\n\n## Candidate Context\n${interviewerContext}\n${skillsContext}\n${experienceContext}\n${companiesContext}\n\n## Personalization Notes\n${personalizationNotes}\n\n## Focus Areas for This Interview\n${focusAreas.map(area => `- ${area}`).join(\"\\n\")}\n\n## Interview Guidelines\n\n1. **Your Personality as Bobby**:\n   - Be warm, encouraging, and professional\n   - Use a conversational tone while maintaining technical rigor\n   - Occasionally use phrases like \"Great point!\", \"That's interesting...\", \"I like that approach\"\n\n2. **Adapt to the Candidate**: Use their background to ask relevant follow-up questions.\n   - If they mention technologies they know, probe deeper on those.\n   - If they're junior, provide more guidance; if senior, expect more depth.\n\n3. **Difficulty Calibration**:\n   ${difficulty === \"easy\" ? \"- Be supportive and provide hints when the candidate is stuck\" : \"\"}\n   ${difficulty === \"medium\" ? \"- Balance guidance with challenge, probe on trade-offs\" : \"\"}\n   ${difficulty === \"hard\" ? \"- Be rigorous, expect precise answers, challenge all decisions\" : \"\"}\n\n4. **Phase Management**: Guide through all phases:\n   - Requirements (8 min) → High-Level Design (12 min) → Deep Dive (12 min) → Scalability (10 min) → Wrap-up (3 min)\n\n5. **Question Style**:\n   - Keep responses concise (2-4 sentences)\n   - Ask one question at a time\n   - Acknowledge good points before probing deeper\n   - Use \"[PHASE_TRANSITION: phase-id]\" to signal phase changes\n\n6. **Personalized Probing**:\n   - If candidate mentions their known technologies, ask how they'd apply them\n   - For target company alignment, use similar question patterns those companies use\n\nStart by introducing yourself as Bobby, mention you're excited to discuss ${topic} with them, and ask the first clarifying question about requirements.`;\n}\n","/**\n * AI Personality Adapter\n *\n * Adapts Bobby's interviewer personality based on user performance.\n * Adjusts encouragement level, challenge intensity, and questioning style.\n */\n\nimport {\n  calculatePerformanceMetrics,\n  getPerformanceCategory,\n} from \"./analytics/performance-analytics\";\n\n// Types\nexport interface PersonalitySettings {\n  encouragementLevel: \"high\" | \"moderate\" | \"low\";\n  challengeLevel: \"gentle\" | \"standard\" | \"rigorous\";\n  hintFrequency: \"frequent\" | \"occasional\" | \"rare\";\n  probingDepth: \"surface\" | \"moderate\" | \"deep\";\n  paceAdjustment: \"slower\" | \"standard\" | \"faster\";\n}\n\nexport interface AdaptedPersonality {\n  settings: PersonalitySettings;\n  promptModifications: string;\n  reasonForAdaptation: string;\n  performanceCategory: \"struggling\" | \"developing\" | \"proficient\" | \"excelling\";\n}\n\n// Personality presets based on performance category\nconst PERSONALITY_PRESETS: Record<string, PersonalitySettings> = {\n  struggling: {\n    encouragementLevel: \"high\",\n    challengeLevel: \"gentle\",\n    hintFrequency: \"frequent\",\n    probingDepth: \"surface\",\n    paceAdjustment: \"slower\",\n  },\n  developing: {\n    encouragementLevel: \"moderate\",\n    challengeLevel: \"gentle\",\n    hintFrequency: \"occasional\",\n    probingDepth: \"moderate\",\n    paceAdjustment: \"standard\",\n  },\n  proficient: {\n    encouragementLevel: \"moderate\",\n    challengeLevel: \"standard\",\n    hintFrequency: \"occasional\",\n    probingDepth: \"moderate\",\n    paceAdjustment: \"standard\",\n  },\n  excelling: {\n    encouragementLevel: \"low\",\n    challengeLevel: \"rigorous\",\n    hintFrequency: \"rare\",\n    probingDepth: \"deep\",\n    paceAdjustment: \"faster\",\n  },\n};\n\n/**\n * Calculate personality adaptation based on user's performance history\n */\nexport async function calculatePersonalityAdaptation(\n  userId: string\n): Promise<AdaptedPersonality> {\n  const metrics = await calculatePerformanceMetrics(userId, 10);\n  const category = getPerformanceCategory(metrics.overall.avgScore);\n  const settings = { ...PERSONALITY_PRESETS[category] };\n\n  // Fine-tune based on specific metrics\n  if (metrics.overall.scoreTrend === \"declining\" && category !== \"struggling\") {\n    // If declining, be more supportive\n    settings.encouragementLevel = \"high\";\n    settings.hintFrequency = \"occasional\";\n  }\n\n  if (metrics.overall.scoreTrend === \"improving\" && category === \"struggling\") {\n    // If improving from a low base, acknowledge progress\n    settings.encouragementLevel = \"high\";\n    settings.challengeLevel = \"gentle\";\n  }\n\n  // Build prompt modifications\n  const promptModifications = buildPersonalityPrompt(settings, category, metrics);\n\n  // Build reason\n  const reasonForAdaptation = buildAdaptationReason(category, metrics);\n\n  return {\n    settings,\n    promptModifications,\n    reasonForAdaptation,\n    performanceCategory: category,\n  };\n}\n\n/**\n * Build personality-adapted prompt section\n */\nfunction buildPersonalityPrompt(\n  settings: PersonalitySettings,\n  category: string,\n  metrics: Awaited<ReturnType<typeof calculatePerformanceMetrics>>\n): string {\n  let prompt = `\n## Bobby's Adapted Personality for This Candidate\n\nBased on this candidate's performance history, adapt your interviewer behavior:\n\n### Encouragement Style (${settings.encouragementLevel})\n`;\n\n  switch (settings.encouragementLevel) {\n    case \"high\":\n      prompt += `- Be extra supportive and positive\n- Celebrate good points with phrases like \"That's a great insight!\" or \"Excellent thinking!\"\n- When they struggle, say things like \"That's okay, let me help guide you...\"\n- Focus on building confidence\n`;\n      break;\n    case \"moderate\":\n      prompt += `- Acknowledge good points with brief praise like \"Good\" or \"That works\"\n- Stay professional and constructive\n- Offer encouragement when appropriate\n`;\n      break;\n    case \"low\":\n      prompt += `- Focus on technical accuracy over praise\n- Keep feedback objective and direct\n- Save encouragement for truly exceptional answers\n`;\n      break;\n  }\n\n  prompt += `\n### Challenge Level (${settings.challengeLevel})\n`;\n\n  switch (settings.challengeLevel) {\n    case \"gentle\":\n      prompt += `- Start with fundamental questions before advancing\n- Break complex topics into smaller parts\n- Give them time to think and don't rush\n- If they struggle, simplify the question\n`;\n      break;\n    case \"standard\":\n      prompt += `- Ask balanced questions that test understanding\n- Probe on tradeoffs and alternatives\n- Challenge decisions but accept reasonable answers\n`;\n      break;\n    case \"rigorous\":\n      prompt += `- Push hard on edge cases and failure scenarios\n- Ask follow-up questions that test depth\n- Challenge assumptions and expect precise answers\n- Don't accept vague answers - probe deeper\n`;\n      break;\n  }\n\n  prompt += `\n### Hints and Guidance (${settings.hintFrequency})\n`;\n\n  switch (settings.hintFrequency) {\n    case \"frequent\":\n      prompt += `- Provide hints proactively when they seem stuck\n- Offer suggestions like \"Have you considered...?\" or \"What about...?\"\n- Guide them towards good solutions\n`;\n      break;\n    case \"occasional\":\n      prompt += `- Give hints if they're clearly stuck after a reasonable attempt\n- Let them work through problems independently first\n`;\n      break;\n    case \"rare\":\n      prompt += `- Only hint if absolutely necessary\n- Let them struggle and find solutions independently\n- They should demonstrate they can problem-solve\n`;\n      break;\n  }\n\n  prompt += `\n### Probing Depth (${settings.probingDepth})\n`;\n\n  switch (settings.probingDepth) {\n    case \"surface\":\n      prompt += `- Focus on high-level understanding\n- Don't dive too deep into implementation details\n- Accept general answers for complex topics\n`;\n      break;\n    case \"moderate\":\n      prompt += `- Balance high-level and detailed questions\n- Probe on important design decisions\n`;\n      break;\n    case \"deep\":\n      prompt += `- Expect detailed explanations for all decisions\n- Ask about implementation specifics, data structures, algorithms\n- Test knowledge of edge cases and failure modes\n`;\n      break;\n  }\n\n  // Add performance context\n  if (metrics.overall.completedInterviews > 0) {\n    prompt += `\n### Performance Context\n- Past interviews: ${metrics.overall.completedInterviews}\n- Average score: ${metrics.overall.avgScore}/4.0\n- Pass rate: ${metrics.overall.passRate}%\n- Trend: ${metrics.overall.scoreTrend}\n`;\n  }\n\n  return prompt;\n}\n\n/**\n * Build human-readable reason for adaptation\n */\nfunction buildAdaptationReason(\n  category: string,\n  metrics: Awaited<ReturnType<typeof calculatePerformanceMetrics>>\n): string {\n  if (metrics.overall.completedInterviews === 0) {\n    return \"First interview - using standard settings.\";\n  }\n\n  switch (category) {\n    case \"struggling\":\n      return `Candidate's average score (${metrics.overall.avgScore}/4) indicates they need more support. Bobby will be more encouraging and provide more guidance.`;\n    case \"developing\":\n      return `Candidate is developing (${metrics.overall.avgScore}/4). Bobby will balance support with challenge.`;\n    case \"proficient\":\n      return `Candidate shows proficiency (${metrics.overall.avgScore}/4). Bobby will use standard interview approach.`;\n    case \"excelling\":\n      return `Candidate is excelling (${metrics.overall.avgScore}/4). Bobby will be more rigorous and challenging.`;\n    default:\n      return \"Using standard interview settings.\";\n  }\n}\n\n/**\n * Build adapted system prompt by combining base prompt with personality modifications\n */\nexport function buildAdaptedSystemPrompt(\n  basePrompt: string,\n  personality: AdaptedPersonality\n): string {\n  // Insert personality modifications after the base interviewer description\n  const insertPoint = basePrompt.indexOf(\"## Interview Structure\");\n\n  if (insertPoint === -1) {\n    // If we can't find the structure section, append at the end\n    return `${basePrompt}\\n\\n${personality.promptModifications}`;\n  }\n\n  return (\n    basePrompt.slice(0, insertPoint) +\n    personality.promptModifications +\n    \"\\n\\n\" +\n    basePrompt.slice(insertPoint)\n  );\n}\n\n/**\n * Get default personality settings for users without history\n */\nexport function getDefaultPersonalitySettings(): PersonalitySettings {\n  return {\n    encouragementLevel: \"moderate\",\n    challengeLevel: \"standard\",\n    hintFrequency: \"occasional\",\n    probingDepth: \"moderate\",\n    paceAdjustment: \"standard\",\n  };\n}\n\n/**\n * Re-export performance category function\n */\nexport { getPerformanceCategory } from \"./analytics/performance-analytics\";\n","/**\n * Personalized Interview API\n *\n * Creates an interview with smart difficulty adjustment and personalized questions\n * based on user profile, skills, experience, and resume analysis.\n *\n * POST /api/interview/personalized\n * Body: { topic: string, selectedDifficulty: \"easy\" | \"medium\" | \"hard\" }\n */\n\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { complete } from \"@/lib/llm\";\nimport {\n  calculateSmartDifficulty,\n  DifficultyLevel,\n  UserProfileData,\n  ResumeData,\n} from \"@/lib/difficulty-calculator\";\nimport {\n  generatePersonalizedQuestions,\n  buildPersonalizedInterviewerPrompt,\n} from \"@/lib/question-generator\";\nimport { buildFollowUpContext } from \"@/lib/followup-engine\";\nimport {\n  calculatePersonalityAdaptation,\n  getPerformanceCategory,\n} from \"@/lib/ai-personality-adapter\";\nimport { calculatePerformanceMetrics } from \"@/lib/analytics/performance-analytics\";\nimport { getPersonalizedInterviewPrompt } from \"@/lib/prompts/interviewer\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    // 1. Authenticate user\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // 2. Parse request body\n    const body = await request.json();\n    const { topic, selectedDifficulty = \"medium\" } = body;\n\n    if (!topic) {\n      return NextResponse.json(\n        { error: \"Topic is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Validate difficulty\n    const validDifficulties: DifficultyLevel[] = [\"easy\", \"medium\", \"hard\"];\n    if (!validDifficulties.includes(selectedDifficulty)) {\n      return NextResponse.json(\n        { error: \"Invalid difficulty level\" },\n        { status: 400 }\n      );\n    }\n\n    // 3. Fetch user profile\n    const profile = await prisma.profile.findUnique({\n      where: { userId: session.user.id },\n    });\n\n    // 4. Fetch latest resume\n    const latestResume = await prisma.resume.findFirst({\n      where: { userId: session.user.id },\n      orderBy: { uploadedAt: \"desc\" },\n    });\n\n    // 5. Parse profile data\n    const profileData: UserProfileData | null = profile\n      ? {\n          yearsExperience: profile.yearsExperience,\n          skills: profile.skills ? JSON.parse(profile.skills) : [],\n          targetCompanies: profile.targetCompanies\n            ? JSON.parse(profile.targetCompanies)\n            : [],\n          targetRole: profile.targetRole,\n          bio: profile.bio,\n        }\n      : null;\n\n    // 6. Parse resume data\n    const resumeData: ResumeData | null = latestResume\n      ? {\n          content: latestResume.content,\n          atsScore: latestResume.atsScore,\n          keywords: latestResume.keywords\n            ? JSON.parse(latestResume.keywords)\n            : [],\n          predictedRoles: latestResume.predictedRoles\n            ? JSON.parse(latestResume.predictedRoles)\n            : [],\n          analysis: latestResume.analysis\n            ? JSON.parse(latestResume.analysis)\n            : null,\n        }\n      : null;\n\n    // 7. Calculate smart difficulty\n    const difficultyResult = calculateSmartDifficulty({\n      selectedDifficulty,\n      profile: profileData,\n      resume: resumeData,\n      topic,\n    });\n\n    const actualDifficulty = difficultyResult.calculatedDifficulty;\n\n    // 8. Fetch performance analytics and build follow-up context\n    const [performanceMetrics, followUpContext, personalityAdaptation] = await Promise.all([\n      calculatePerformanceMetrics(session.user.id, 15),\n      buildFollowUpContext(session.user.id, topic),\n      calculatePersonalityAdaptation(session.user.id),\n    ]);\n\n    // 9. Generate personalized questions with follow-up context\n    const questionSet = await generatePersonalizedQuestions({\n      topic,\n      difficulty: actualDifficulty,\n      profile: profileData,\n      resume: resumeData,\n      followUpContext,\n      userId: session.user.id,\n    });\n\n    // 10. Build personalized interviewer prompt with personality adaptation\n    const interviewerPrompt = getPersonalizedInterviewPrompt(\n      topic,\n      actualDifficulty,\n      personalityAdaptation,\n      followUpContext\n    );\n\n    // 11. Create interview record\n    const interview = await prisma.interview.create({\n      data: {\n        userId: session.user.id,\n        topic,\n        difficulty: actualDifficulty,\n        status: \"in_progress\",\n        startedAt: new Date(),\n      },\n    });\n\n    // 12. Generate initial interviewer message using LLM (Ollama with OpenAI fallback)\n    const initialCompletion = await complete({\n      messages: [\n        { role: \"system\", content: interviewerPrompt },\n        { role: \"user\", content: \"Start the interview.\" },\n      ],\n      maxTokens: 500,\n      temperature: 0.7,\n    });\n\n    const initialMessage =\n      initialCompletion.content ||\n      `Hey there! I'm Bobby, and I'll be your interviewer today. I'm excited to discuss ${topic} with you! Let's start with some clarifying questions - what's the first thing you'd want to understand about the requirements?`;\n\n    // 13. Save messages to database\n    await prisma.message.createMany({\n      data: [\n        {\n          interviewId: interview.id,\n          role: \"system\",\n          content: interviewerPrompt,\n        },\n        {\n          interviewId: interview.id,\n          role: \"assistant\",\n          content: initialMessage,\n        },\n      ],\n    });\n\n    // 14. Return response with full personalization info\n    return NextResponse.json({\n      success: true,\n      interview: {\n        id: interview.id,\n        topic: interview.topic,\n        difficulty: interview.difficulty,\n        status: interview.status,\n        startedAt: interview.startedAt,\n      },\n      initialMessage,\n      personalization: {\n        selectedDifficulty,\n        calculatedDifficulty: actualDifficulty,\n        wasAdjusted: selectedDifficulty !== actualDifficulty,\n        adjustmentReason: difficultyResult.adjustmentReason,\n        confidenceScore: difficultyResult.confidenceScore,\n        breakdown: difficultyResult.breakdown,\n        recommendations: difficultyResult.recommendations,\n        // New personalization fields\n        performanceCategory: personalityAdaptation.performanceCategory,\n        personalityAdaptation: personalityAdaptation.reasonForAdaptation,\n        weakAreasTargeted: followUpContext.weakPoints.map((wp) => wp.dimension),\n        hasHistory: followUpContext.hasHistory,\n        totalPastInterviews: followUpContext.totalPastInterviews,\n        adaptedDifficulty: followUpContext.adaptedDifficulty,\n      },\n      questionSet: {\n        focusAreas: questionSet.focusAreas,\n        personalizationNotes: questionSet.personalizationNotes,\n        questionCount: questionSet.questions.length,\n      },\n      performanceContext: {\n        avgScore: performanceMetrics.overall.avgScore,\n        passRate: performanceMetrics.overall.passRate,\n        scoreTrend: performanceMetrics.overall.scoreTrend,\n        completedInterviews: performanceMetrics.overall.completedInterviews,\n      },\n    });\n  } catch (error) {\n    console.error(\"Personalized interview creation error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to create personalized interview\" },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * GET endpoint to preview difficulty calculation without creating interview\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const selectedDifficulty =\n      (searchParams.get(\"difficulty\") as DifficultyLevel) || \"medium\";\n    const topic = searchParams.get(\"topic\") || \"System Design\";\n\n    // Fetch user data\n    const profile = await prisma.profile.findUnique({\n      where: { userId: session.user.id },\n    });\n\n    const latestResume = await prisma.resume.findFirst({\n      where: { userId: session.user.id },\n      orderBy: { uploadedAt: \"desc\" },\n    });\n\n    // Parse data\n    const profileData: UserProfileData | null = profile\n      ? {\n          yearsExperience: profile.yearsExperience,\n          skills: profile.skills ? JSON.parse(profile.skills) : [],\n          targetCompanies: profile.targetCompanies\n            ? JSON.parse(profile.targetCompanies)\n            : [],\n          targetRole: profile.targetRole,\n          bio: profile.bio,\n        }\n      : null;\n\n    const resumeData: ResumeData | null = latestResume\n      ? {\n          content: latestResume.content,\n          atsScore: latestResume.atsScore,\n          keywords: latestResume.keywords\n            ? JSON.parse(latestResume.keywords)\n            : [],\n          predictedRoles: latestResume.predictedRoles\n            ? JSON.parse(latestResume.predictedRoles)\n            : [],\n          analysis: latestResume.analysis\n            ? JSON.parse(latestResume.analysis)\n            : null,\n        }\n      : null;\n\n    // Calculate difficulty\n    const difficultyResult = calculateSmartDifficulty({\n      selectedDifficulty,\n      profile: profileData,\n      resume: resumeData,\n      topic,\n    });\n\n    return NextResponse.json({\n      selectedDifficulty,\n      calculatedDifficulty: difficultyResult.calculatedDifficulty,\n      wasAdjusted: selectedDifficulty !== difficultyResult.calculatedDifficulty,\n      adjustmentReason: difficultyResult.adjustmentReason,\n      confidenceScore: difficultyResult.confidenceScore,\n      breakdown: difficultyResult.breakdown,\n      recommendations: difficultyResult.recommendations,\n      profileSummary: {\n        hasProfile: !!profile,\n        hasResume: !!latestResume,\n        yearsExperience: profileData?.yearsExperience || null,\n        skillsCount: profileData?.skills?.length || 0,\n        targetCompaniesCount: profileData?.targetCompanies?.length || 0,\n      },\n    });\n  } catch (error) {\n    console.error(\"Difficulty preview error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to calculate difficulty\" },\n      { status: 500 }\n    );\n  }\n}\n","import {\n  AppRouteRouteModule,\n  type AppRouteRouteHandlerContext,\n  type AppRouteRouteModuleOptions,\n} from '../../server/route-modules/app-route/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\nimport { patchFetch as _patchFetch } from '../../server/lib/patch-fetch'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\nimport { addRequestMeta, getRequestMeta } from '../../server/request-meta'\nimport { getTracer, type Span, SpanKind } from '../../server/lib/trace/tracer'\nimport { setManifestsSingleton } from '../../server/app-render/manifests-singleton'\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\nimport { NodeNextRequest, NodeNextResponse } from '../../server/base-http/node'\nimport {\n  NextRequestAdapter,\n  signalFromNodeResponse,\n} from '../../server/web/spec-extension/adapters/next-request'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport { getRevalidateReason } from '../../server/instrumentation/utils'\nimport { sendResponse } from '../../server/send-response'\nimport {\n  fromNodeOutgoingHttpHeaders,\n  toNodeOutgoingHttpHeaders,\n} from '../../server/web/utils'\nimport { getCacheControlHeader } from '../../server/lib/cache-control'\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from '../../lib/constants'\nimport { NoFallbackError } from '../../shared/lib/no-fallback-error.external'\nimport {\n  CachedRouteKind,\n  type ResponseCacheEntry,\n  type ResponseGenerator,\n} from '../../server/response-cache'\n\nimport * as userland from 'VAR_USERLAND'\n\n// These are injected by the loader afterwards. This is injected as a variable\n// instead of a replacement because this could also be `undefined` instead of\n// an empty string.\ndeclare const nextConfigOutput: AppRouteRouteModuleOptions['nextConfigOutput']\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\n// INJECT:nextConfigOutput\n\nconst routeModule = new AppRouteRouteModule({\n  definition: {\n    kind: RouteKind.APP_ROUTE,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    filename: 'VAR_DEFINITION_FILENAME',\n    bundlePath: 'VAR_DEFINITION_BUNDLE_PATH',\n  },\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n  resolvedPagePath: 'VAR_RESOLVED_PAGE_PATH',\n  nextConfigOutput,\n  userland,\n})\n\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule\n\nfunction patchFetch() {\n  return _patchFetch({\n    workAsyncStorage,\n    workUnitAsyncStorage,\n  })\n}\n\nexport {\n  routeModule,\n  workAsyncStorage,\n  workUnitAsyncStorage,\n  serverHooks,\n  patchFetch,\n}\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil: (prom: Promise<void>) => void\n  }\n) {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  } else if (srcPage === '/index') {\n    // we always normalize /index specifically\n    srcPage = '/'\n  }\n  const multiZoneDraftMode = process.env\n    .__NEXT_MULTI_ZONE_DRAFT_MODE as any as boolean\n\n  const prepareResult = await routeModule.prepare(req, res, {\n    srcPage,\n    multiZoneDraftMode,\n  })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return null\n  }\n\n  const {\n    buildId,\n    params,\n    nextConfig,\n    parsedUrl,\n    isDraftMode,\n    prerenderManifest,\n    routerServerContext,\n    isOnDemandRevalidate,\n    revalidateOnlyGenerated,\n    resolvedPathname,\n    clientReferenceManifest,\n    serverActionsManifest,\n  } = prepareResult\n\n  const normalizedSrcPage = normalizeAppPath(srcPage)\n\n  let isIsr = Boolean(\n    prerenderManifest.dynamicRoutes[normalizedSrcPage] ||\n      prerenderManifest.routes[resolvedPathname]\n  )\n\n  const render404 = async () => {\n    // TODO: should route-module itself handle rendering the 404\n    if (routerServerContext?.render404) {\n      await routerServerContext.render404(req, res, parsedUrl, false)\n    } else {\n      res.end('This page could not be found')\n    }\n    return null\n  }\n\n  if (isIsr && !isDraftMode) {\n    const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname])\n    const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage]\n\n    if (prerenderInfo) {\n      if (prerenderInfo.fallback === false && !isPrerendered) {\n        if (nextConfig.experimental.adapterPath) {\n          return await render404()\n        }\n        throw new NoFallbackError()\n      }\n    }\n  }\n\n  let cacheKey: string | null = null\n\n  if (isIsr && !routeModule.isDev && !isDraftMode) {\n    cacheKey = resolvedPathname\n    // ensure /index and / is normalized to one key\n    cacheKey = cacheKey === '/index' ? '/' : cacheKey\n  }\n\n  const supportsDynamicResponse: boolean =\n    // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true ||\n    // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr\n\n  // This is a revalidation request if the request is for a static\n  // page and it is not being resumed from a postponed render and\n  // it is not a dynamic RSC request then it is a revalidation\n  // request.\n  const isStaticGeneration = isIsr && !supportsDynamicResponse\n\n  // Before rendering (which initializes component tree modules), we have to\n  // set the reference manifests to our global store so Server Action's\n  // encryption util can access to them at the top level of the page module.\n  if (serverActionsManifest && clientReferenceManifest) {\n    setManifestsSingleton({\n      page: srcPage,\n      clientReferenceManifest,\n      serverActionsManifest,\n    })\n  }\n\n  const method = req.method || 'GET'\n  const tracer = getTracer()\n  const activeSpan = tracer.getActiveScopeSpan()\n\n  const context: AppRouteRouteHandlerContext = {\n    params,\n    prerenderManifest,\n    renderOpts: {\n      experimental: {\n        authInterrupts: Boolean(nextConfig.experimental.authInterrupts),\n      },\n      cacheComponents: Boolean(nextConfig.cacheComponents),\n      supportsDynamicResponse,\n      incrementalCache: getRequestMeta(req, 'incrementalCache'),\n      cacheLifeProfiles: nextConfig.cacheLife,\n      waitUntil: ctx.waitUntil,\n      onClose: (cb) => {\n        res.on('close', cb)\n      },\n      onAfterTaskError: undefined,\n      onInstrumentationRequestError: (\n        error,\n        _request,\n        errorContext,\n        silenceLog\n      ) =>\n        routeModule.onRequestError(\n          req,\n          error,\n          errorContext,\n          silenceLog,\n          routerServerContext\n        ),\n    },\n    sharedContext: {\n      buildId,\n    },\n  }\n  const nodeNextReq = new NodeNextRequest(req)\n  const nodeNextRes = new NodeNextResponse(res)\n\n  const nextReq = NextRequestAdapter.fromNodeNextRequest(\n    nodeNextReq,\n    signalFromNodeResponse(res)\n  )\n\n  try {\n    const invokeRouteModule = async (span?: Span) => {\n      return routeModule.handle(nextReq, context).finally(() => {\n        if (!span) return\n\n        span.setAttributes({\n          'http.status_code': res.statusCode,\n          'next.rsc': false,\n        })\n\n        const rootSpanAttributes = tracer.getRootSpanAttributes()\n        // We were unable to get attributes, probably OTEL is not enabled\n        if (!rootSpanAttributes) {\n          return\n        }\n\n        if (\n          rootSpanAttributes.get('next.span_type') !==\n          BaseServerSpan.handleRequest\n        ) {\n          console.warn(\n            `Unexpected root span type '${rootSpanAttributes.get(\n              'next.span_type'\n            )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n          )\n          return\n        }\n\n        const route = rootSpanAttributes.get('next.route')\n        if (route) {\n          const name = `${method} ${route}`\n\n          span.setAttributes({\n            'next.route': route,\n            'http.route': route,\n            'next.span_name': name,\n          })\n          span.updateName(name)\n        } else {\n          span.updateName(`${method} ${srcPage}`)\n        }\n      })\n    }\n    const isMinimalMode = Boolean(\n      process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode')\n    )\n\n    const handleResponse = async (currentSpan?: Span) => {\n      const responseGenerator: ResponseGenerator = async ({\n        previousCacheEntry,\n      }) => {\n        try {\n          if (\n            !isMinimalMode &&\n            isOnDemandRevalidate &&\n            revalidateOnlyGenerated &&\n            !previousCacheEntry\n          ) {\n            res.statusCode = 404\n            // on-demand revalidate always sets this header\n            res.setHeader('x-nextjs-cache', 'REVALIDATED')\n            res.end('This page could not be found')\n            return null\n          }\n\n          const response = await invokeRouteModule(currentSpan)\n\n          ;(req as any).fetchMetrics = (context.renderOpts as any).fetchMetrics\n          let pendingWaitUntil = context.renderOpts.pendingWaitUntil\n\n          // Attempt using provided waitUntil if available\n          // if it's not we fallback to sendResponse's handling\n          if (pendingWaitUntil) {\n            if (ctx.waitUntil) {\n              ctx.waitUntil(pendingWaitUntil)\n              pendingWaitUntil = undefined\n            }\n          }\n          const cacheTags = context.renderOpts.collectedTags\n\n          // If the request is for a static response, we can cache it so long\n          // as it's not edge.\n          if (isIsr) {\n            const blob = await response.blob()\n\n            // Copy the headers from the response.\n            const headers = toNodeOutgoingHttpHeaders(response.headers)\n\n            if (cacheTags) {\n              headers[NEXT_CACHE_TAGS_HEADER] = cacheTags\n            }\n\n            if (!headers['content-type'] && blob.type) {\n              headers['content-type'] = blob.type\n            }\n\n            const revalidate =\n              typeof context.renderOpts.collectedRevalidate === 'undefined' ||\n              context.renderOpts.collectedRevalidate >= INFINITE_CACHE\n                ? false\n                : context.renderOpts.collectedRevalidate\n\n            const expire =\n              typeof context.renderOpts.collectedExpire === 'undefined' ||\n              context.renderOpts.collectedExpire >= INFINITE_CACHE\n                ? undefined\n                : context.renderOpts.collectedExpire\n\n            // Create the cache entry for the response.\n            const cacheEntry: ResponseCacheEntry = {\n              value: {\n                kind: CachedRouteKind.APP_ROUTE,\n                status: response.status,\n                body: Buffer.from(await blob.arrayBuffer()),\n                headers,\n              },\n              cacheControl: { revalidate, expire },\n            }\n\n            return cacheEntry\n          } else {\n            // send response without caching if not ISR\n            await sendResponse(\n              nodeNextReq,\n              nodeNextRes,\n              response,\n              context.renderOpts.pendingWaitUntil\n            )\n            return null\n          }\n        } catch (err) {\n          // if this is a background revalidate we need to report\n          // the request error here as it won't be bubbled\n          if (previousCacheEntry?.isStale) {\n            const silenceLog = false\n            await routeModule.onRequestError(\n              req,\n              err,\n              {\n                routerKind: 'App Router',\n                routePath: srcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                  isStaticGeneration,\n                  isOnDemandRevalidate,\n                }),\n              },\n              silenceLog,\n              routerServerContext\n            )\n          }\n          throw err\n        }\n      }\n\n      const cacheEntry = await routeModule.handleResponse({\n        req,\n        nextConfig,\n        cacheKey,\n        routeKind: RouteKind.APP_ROUTE,\n        isFallback: false,\n        prerenderManifest,\n        isRoutePPREnabled: false,\n        isOnDemandRevalidate,\n        revalidateOnlyGenerated,\n        responseGenerator,\n        waitUntil: ctx.waitUntil,\n        isMinimalMode,\n      })\n\n      // we don't create a cacheEntry for ISR\n      if (!isIsr) {\n        return null\n      }\n\n      if (cacheEntry?.value?.kind !== CachedRouteKind.APP_ROUTE) {\n        throw new Error(\n          `Invariant: app-route received invalid cache entry ${cacheEntry?.value?.kind}`\n        )\n      }\n\n      if (!isMinimalMode) {\n        res.setHeader(\n          'x-nextjs-cache',\n          isOnDemandRevalidate\n            ? 'REVALIDATED'\n            : cacheEntry.isMiss\n              ? 'MISS'\n              : cacheEntry.isStale\n                ? 'STALE'\n                : 'HIT'\n        )\n      }\n\n      // Draft mode should never be cached\n      if (isDraftMode) {\n        res.setHeader(\n          'Cache-Control',\n          'private, no-cache, no-store, max-age=0, must-revalidate'\n        )\n      }\n\n      const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers)\n\n      if (!(isMinimalMode && isIsr)) {\n        headers.delete(NEXT_CACHE_TAGS_HEADER)\n      }\n\n      // If cache control is already set on the response we don't\n      // override it to allow users to customize it via next.config\n      if (\n        cacheEntry.cacheControl &&\n        !res.getHeader('Cache-Control') &&\n        !headers.get('Cache-Control')\n      ) {\n        headers.set(\n          'Cache-Control',\n          getCacheControlHeader(cacheEntry.cacheControl)\n        )\n      }\n\n      await sendResponse(\n        nodeNextReq,\n        nodeNextRes,\n        // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n        new Response(cacheEntry.value.body, {\n          headers,\n          status: cacheEntry.value.status || 200,\n        })\n      )\n      return null\n    }\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await handleResponse(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          handleResponse\n        )\n      )\n    }\n  } catch (err) {\n    if (!(err instanceof NoFallbackError)) {\n      const silenceLog = false\n      await routeModule.onRequestError(\n        req,\n        err,\n        {\n          routerKind: 'App Router',\n          routePath: normalizedSrcPage,\n          routeType: 'route',\n          revalidateReason: getRevalidateReason({\n            isStaticGeneration,\n            isOnDemandRevalidate,\n          }),\n        },\n        silenceLog,\n        routerServerContext\n      )\n    }\n\n    // rethrow so that we can handle serving error page\n\n    // If this is during static generation, throw the error again.\n    if (isIsr) throw err\n\n    // Otherwise, send a 500 response.\n    await sendResponse(\n      nodeNextReq,\n      nodeNextRes,\n      new Response(null, { status: 500 })\n    )\n    return null\n  }\n}\n"],"names":["AppRouteRouteModule","RouteKind","patchFetch","_patchFetch","addRequestMeta","getRequestMeta","getTracer","SpanKind","setManifestsSingleton","normalizeAppPath","NodeNextRequest","NodeNextResponse","NextRequestAdapter","signalFromNodeResponse","BaseServerSpan","getRevalidateReason","sendResponse","fromNodeOutgoingHttpHeaders","toNodeOutgoingHttpHeaders","getCacheControlHeader","INFINITE_CACHE","NEXT_CACHE_TAGS_HEADER","NoFallbackError","CachedRouteKind","userland","routeModule","definition","kind","APP_ROUTE","page","pathname","filename","bundlePath","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","resolvedPagePath","nextConfigOutput","workAsyncStorage","workUnitAsyncStorage","serverHooks","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","multiZoneDraftMode","__NEXT_MULTI_ZONE_DRAFT_MODE","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","buildId","params","nextConfig","parsedUrl","isDraftMode","prerenderManifest","routerServerContext","isOnDemandRevalidate","revalidateOnlyGenerated","resolvedPathname","clientReferenceManifest","serverActionsManifest","normalizedSrcPage","isIsr","Boolean","dynamicRoutes","routes","render404","isPrerendered","prerenderInfo","fallback","experimental","adapterPath","cacheKey","supportsDynamicResponse","isStaticGeneration","method","tracer","activeSpan","getActiveScopeSpan","context","renderOpts","authInterrupts","cacheComponents","incrementalCache","cacheLifeProfiles","cacheLife","onClose","cb","on","onAfterTaskError","undefined","onInstrumentationRequestError","error","_request","errorContext","silenceLog","onRequestError","sharedContext","nodeNextReq","nodeNextRes","nextReq","fromNodeNextRequest","invokeRouteModule","span","handle","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","isMinimalMode","MINIMAL_MODE","handleResponse","currentSpan","cacheEntry","responseGenerator","previousCacheEntry","setHeader","response","fetchMetrics","pendingWaitUntil","cacheTags","collectedTags","blob","headers","type","revalidate","collectedRevalidate","expire","collectedExpire","value","status","body","Buffer","from","arrayBuffer","cacheControl","err","isStale","routerKind","routePath","routeType","revalidateReason","routeKind","isFallback","isRoutePPREnabled","Error","isMiss","delete","getHeader","set","Response","withPropagatedContext","trace","spanName","SERVER","attributes","url"],"mappings":"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","ignoreList":[4]}